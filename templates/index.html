<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>RoadVision AI â€“ Cyberpunk Monitor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #0b0c10;
            color: #00ffcc;
            font-family: 'Consolas', 'Courier New', monospace;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        /* --- HEADER --- */
        .header-bar {
            background: #0b0c10;
            border-bottom: 2px solid #00ffcc;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 0 15px #00ffcc33;
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        .header-title {
            font-size: 2.4rem;
            font-weight: 700;
            color: #00ffcc;
            text-shadow: 0 0 12px #00ffcc, 0 0 24px #ff00ff;
        }

        .header-desc {
            font-size: 1rem;
            color: #66ffe0;
            text-shadow: 0 0 8px #00ffcc, 0 0 16px #ff00ff33;
        }

        /* Right status panel */
        .status-bar {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 0.95rem;
        }

        .status-item {
            background: rgba(0, 255, 204, 0.05);
            padding: 6px 14px;
            border-radius: 10px;
            border: 1px solid #00ffcc33;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-active {
            background: #22ff22;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.4);
                opacity: 0.6;
            }
        }

        /* --- CCTV Grid --- */
        .cctv-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px;
            height: calc(100vh - 120px);
            /* header + padding */
        }

        .cctv-box,
        .upload-card {
            background: rgba(10, 12, 16, 0.8);
            border: 2px solid #00ffcc;
            border-radius: 10px;
            cursor: pointer;
            overflow: hidden;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
        }

        .cctv-box:hover,
        .upload-card:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px #00ffcc, 0 0 30px #ff00ff;
        }

        video {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-bottom: 1px solid #00ffcc33;
        }

        .cctv-label {
            background: #0b0c10;
            color: #00ffcc;
            font-weight: 500;
            text-align: center;
            padding: 6px;
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 0 0 4px #00ffcc, 0 0 8px #ff00ff;
        }

        /* --- Upload Card --- */
        .upload-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed #00ffcc;
            min-height: 200px;
            padding: 15px;
        }

        .upload-card h2 {
            font-size: 3rem;
            color: #ff00ff;
            margin: 0;
            text-shadow: 0 0 12px #ff00ff, 0 0 20px #00ffcc;
        }

        .upload-card p {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #00ffcc;
            text-align: center;
        }

        /* --- Segmentation Modal --- */
        .modal-content.border-glow {
            background: #111;
            border-radius: 20px;
            border: 4px solid #00ff99;
            box-shadow: 0 0 40px #00ff99, 0 0 80px rgba(0, 255, 153, 0.5);
            overflow: hidden;
        }

        .modal-header.border-bottom-glow {
            border-bottom: 3px solid #00ff99;
        }

        .modal-title {
            color: #00ff99;
            font-weight: 700;
            text-shadow: 0 0 8px #00ffaa;
        }

        /* --- Enlarged Modal --- */
        .modal-dialog.modal-xl {
            max-width: 90%;
            height: 90%;
        }

        .modal-content {
            height: 100%;
        }

        .modal-body {
            height: calc(100% - 60px);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #segmentedVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0;
            position: relative;
            z-index: 5;
        }

        /* Spinner Styling */
        #spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10;
            transition: 0.3s;
        }

        #spinner p {
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.2rem;
            color: #00ff99;
            text-shadow: 0 0 10px #00ff99, 0 0 20px #00ffaa;
        }

        /* --- Segmentation Modal Shadow --- */

        /* Modal Glow - Changed to purple/cyan for contrast with green segmentation */
        .modal-content.bg-dark {
            background: #111;
            border-radius: 20px;
            border: 4px solid #8a2be2;
            box-shadow:
                0 0 20px #8a2be2,
                0 0 40px #00ffff,
                0 0 60px #8a2be2,
                0 0 80px rgba(0, 255, 255, 0.3);
            overflow: hidden;
            transition: box-shadow 0.3s ease-in-out;
        }

        .modal-content.bg-dark:hover {
            box-shadow:
                0 0 30px #8a2be2,
                0 0 60px #00ffff,
                0 0 90px #8a2be2,
                0 0 120px rgba(0, 255, 255, 0.5);
        }
    </style>
</head>

<body>

    <!-- HEADER -->
    <div class="header-bar">
        <div class="header-left">
            <div class="header-title">âš¡ RoadVision AI â€“ Cyberpunk Monitor</div>
            <div class="header-desc">Monitoring live road conditions with advanced AI segmentation. Stay updated in
                real-time.</div>
        </div>
        <div class="status-bar">
            <div class="status-item"><span class="status-dot status-active"></span> System: Active</div>
            <div class="status-item">ðŸ•’ <span id="systemTime"></span></div>
            <div class="status-item">ðŸ–¥ Screens: 8</div>
        </div>
    </div>

    <!-- CCTV GRID -->
    <div class="cctv-grid">
        {% for i in range(8) %}
        <div class="cctv-box" onclick="openSegmentation('vid{{i+1}}.mp4')">
            <video autoplay loop muted>
                <source src="{{ url_for('static', filename='videos/vid' ~ (i+1) ~ '.mp4') }}" type="video/mp4">
            </video>
            <div class="cctv-label">
                CAM {{i+1}} - {% if i == 0 %}Front road{% elif i == 1 %}Highway exit{% elif i == 2 %}Side street{% elif
                i == 3 %}Main junction{% elif i == 4 %}Parking lot{% elif i == 5 %}Highway entry{% elif i == 6 %}Toll
                booth{% elif i == 7 %}Rural road{% endif %}
            </div>
        </div>
        {% endfor %}

        <!-- Upload Card -->
        <div class="upload-card" onclick="openUploadModal()">
            <h2>+</h2>
            <p>Upload custom video for live AI segmentation</p>
        </div>
    </div>

    <!-- Segmentation Modal -->
    <div class="modal fade" id="videoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Live Segmentation</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="segmentedVideo" src="" />
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Video</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm">
                        <input type="file" name="video" accept="video/*" required class="form-control mb-3">
                        <button type="submit" class="btn btn-info w-100">Upload & Stream</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Live clock with date
        function updateTime() {
            const now = new Date();
            document.getElementById("systemTime").innerText = now.toLocaleString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        const videoModal = new bootstrap.Modal(document.getElementById('videoModal'));
        const uploadModal = new bootstrap.Modal(document.getElementById('uploadModal'));
        const segmentedVideo = document.getElementById('segmentedVideo');

        function openSegmentation(filename) {
            segmentedVideo.src = `/stream/${filename}?` + new Date().getTime();  // force no-cache
            videoModal.show();
        }

        function openUploadModal() {
            uploadModal.show();
        }

        document.getElementById('uploadForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            uploadModal.hide();
            fetch("/upload", { method: "POST", body: formData })
                .then(res => res.json())
                .then(data => {
                    segmentedVideo.src = data.stream_url + "?" + new Date().getTime();
                    videoModal.show();
                });
        });
    </script>
</body>

</html>