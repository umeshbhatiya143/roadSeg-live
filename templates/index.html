<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RoadVision AI â€“ Live Segmentation</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background:#0b0b0b; color:#e0e0e0; font-family:'Segoe UI'; }
/* --- CCTV Grid --- */
.cctv-grid {
    display:grid; 
    grid-template-columns:repeat(3,1fr); 
    gap:20px; 
    margin-top:30px;
}
.cctv-box {
    background:#000; 
    border:2px solid #00ff99; 
    border-radius:8px; 
    cursor:pointer; 
    overflow:hidden; 
    transition:0.3s;
}
.cctv-box:hover {
    transform:scale(1.05); 
    box-shadow:0 0 30px #00ffaa;
}
video {
    width:100%; 
    height: 300px; 
    object-fit:cover;
    border-radius:5px;
}

/* --- Buttons --- */
.btn-custom {
    background:#00ff99; 
    color:#000; 
    font-weight:bold; 
    border-radius:5px;
    transition:0.3s;
}
.btn-custom:hover {
    background:#3cffaa;
    color:#000;
}

/* --- Segmentation Modal --- */
.modal-content.border-glow {
    background:#111;
    border-radius:20px;
    border:4px solid #00ff99;
    box-shadow: 0 0 40px #00ff99, 0 0 80px rgba(0, 255, 153, 0.5);
    overflow:hidden;
}

.modal-header.border-bottom-glow {
    border-bottom:3px solid #00ff99;
}

.modal-title {
    color:#00ff99;
    font-weight:700;
    text-shadow:0 0 8px #00ffaa;
}

/* Video styling */
#segmentedVideo {
    width:100%;
    height:100%;
    object-fit:cover;
    border-radius:0;
    position:relative;
    z-index:5;
}

/* Spinner Styling */
#spinner {
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100%;
    width:100%;
    position:absolute;
    top:0;
    left:0;
    background:rgba(0,0,0,0.85);
    z-index:10;
    transition:0.3s;
}
#spinner p {
    margin-top:15px;
    font-weight:bold;
    font-size:1.2rem;
    color:#00ff99;
    text-shadow:0 0 10px #00ff99,0 0 20px #00ffaa;
}

/* Upload Modal Styling */
.modal-content.bg-dark.text-white {
    border-radius:15px;
    border:3px solid #00ff99;
    box-shadow:0 0 25px #00ff99;
}

/* Responsive Fullscreen for Video Modal */
@media (min-width: 768px) {
    .modal-dialog {
        max-width:90%;
    }
    .modal-body {
        height:80vh;
        padding:0;
        position:relative;
    }
}

</style>
</head>
<body class="container py-4">

<h1 class="text-center mb-4">ðŸŽ¥ RoadVision AI â€“ Live Road Segmentation</h1>

<div class="cctv-grid">
{% for i in range(6) %}
<div class="cctv-box" onclick="openSegmentation('vid{{i+1}}.mp4')">
    <video autoplay loop muted>
        <source src="{{ url_for('static', filename='videos/vid' ~ (i+1) ~ '.mp4') }}" type="video/mp4">
    </video>
    <div class="p-2 text-center" style="background:#111; color:#00ff99; font-weight:bold; border-top:1px solid #00ff99;">
        CAM {{i+1}} - 
        {% if i == 0 %}
            Front road view covering main intersection.
        {% elif i == 1 %}
            Overhead view of highway exit.
        {% elif i == 2 %}
            Side street coverage monitoring local traffic.
        {% elif i == 3 %}
            Main road junction with high traffic density.
        {% elif i == 4 %}
            Parking lot area for vehicle monitoring.
        {% elif i == 5 %}
            Highway entry point monitoring incoming traffic.
        {% endif %}
    </div>
</div>
{% endfor %}
</div>


<div class="text-center mt-5">
    <button class="btn btn-custom px-4 py-2" onclick="openUploadModal()">Upload Video</button>
</div>

<!-- Segmentation Modal -->
<div class="modal fade" id="videoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">Live Segmentation</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <img id="segmentedVideo" src="" />
      </div>
    </div>
  </div>
</div>

<!-- Upload Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">Upload Video</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="uploadForm">
            <input type="file" name="video" accept="video/*" required class="form-control mb-3">
            <button type="submit" class="btn btn-custom w-100">Upload & Stream</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const videoModal = new bootstrap.Modal(document.getElementById('videoModal'));
const uploadModal = new bootstrap.Modal(document.getElementById('uploadModal'));
const segmentedVideo = document.getElementById('segmentedVideo');

function openSegmentation(filename){
    segmentedVideo.src = `/stream/${filename}?` + new Date().getTime();  // force no-cache
    videoModal.show();
}

function openUploadModal(){
    uploadModal.show();
}

document.getElementById('uploadForm').addEventListener('submit', function(e){
    e.preventDefault();
    const formData = new FormData(this);
    uploadModal.hide();
    fetch("/upload", { method:"POST", body: formData })
      .then(res => res.json())
      .then(data => {
        segmentedVideo.src = data.stream_url + "?" + new Date().getTime();
        videoModal.show();
      });
});
</script>
</body>
</html>
